<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ART and ASSET Tracking</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <p>読み込み中です…少々お待ちください。</p>

  <script>
    // ★設定（あなた専用）
    const LIFF_ID = 'const LIFF_ID = '2009197031-WI4KvEqT';
    const MAKE_WEBHOOK_URL = 'https://hook.us2.make.com/c3ayt3o4bqfu5i7dnhyla2dx2x6pneor';

    function getSerialFromQuery() {
      const params = new URLSearchParams(window.location.search);
      return params.get('sid') || '';
    }

    async function main() {
      await liff.init({ liffId: LIFF_ID });

      // LINEアプリ外ならLINEログインへ飛ばす
      if (!liff.isInClient()) {
        liff.login();
        return;
      }

      const profile = await liff.getProfile();
      const userId = profile.userId;
      const displayName = profile.displayName;
      const serial = getSerialFromQuery();
      const now = new Date().toISOString();

      await fetch(MAKE_WEBHOOK_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          userId,
          displayName,
          serial,
          createdAt: now
        })
      });

      alert('登録が完了しました。ありがとうございます！');
      liff.closeWindow();
    }

    main().catch(err => {
      console.error(err);
      alert('エラーが発生しました。時間をおいて再度お試しください。');
    });
  </script>
</body>
</html>


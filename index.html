<script>
const LIFF_ID = '2009197031-WI4KvEqT';
// Make にはまだ送らないテスト用
const MAKE_WEBHOOK_URL = 'https://hook.us2.make.com/xxxxxxxxxxxxxxxxxxxxxxxx'; 

async function main() {
  try {
    // 1. LIFF 初期化
    await liff.init({ liffId: LIFF_ID });

    // 2. LINEの外（ブラウザ）から来た場合はログインさせる
    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    // 3. プロフィール取得して表示
    const profile = await liff.getProfile();
    const urlParams = new URLSearchParams(window.location.search);
    const sid = urlParams.get('sid');

    alert(
      'LIFFテストOK\n\n' +
      'displayName: ' + profile.displayName + '\n' +
      'userId(先頭10文字): ' + profile.userId.substring(0, 10) + '...\n' +
      'sid: ' + sid
    );

    // ここまで来れば LIFF は正常。
    // この先（Make への送信）は一旦コメントアウトしておく。

    /*
    const res = await fetch(MAKE_WEBHOOK_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        displayName: profile.displayName,
        userId: profile.userId,
        serial: sid,
      }),
    });

    if (!res.ok) {
      throw new Error('Webhook Error: ' + res.status);
    }

    alert('Makeへの送信も成功しました');
    */

  } catch (e) {
    alert('エラー内容: ' + (e.message || e));
  }
}

main();
</script>




